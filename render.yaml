services:
  - type: web
    name: noteflow-ai
    runtime: python
    # Install deps, optional cookies file, and Node.js so yt-dlp can solve YouTube JS challenges
    buildCommand: |
      pip install -r requirements.txt
      if [ -n "$YOUTUBE_COOKIES_TXT" ]; then printf '%s' "$YOUTUBE_COOKIES_TXT" > youtube_cookies.txt; fi
      if ! command -v node >/dev/null 2>&1; then
        curl -fsSL https://nodejs.org/dist/v20.10.0/node-v20.10.0-linux-x64.tar.xz -o /tmp/node.tar.xz
        tar xJf /tmp/node.tar.xz -C /tmp
        mv /tmp/node-v20.10.0-linux-x64 node
      fi
    startCommand: ./start.sh
    envVars:
      - key: SECRET_KEY
        generateValue: true
      - key: ASSEMBLYAI_API_KEY
        sync: false
      - key: GROQ_API_KEY
        sync: false
      - key: OPENAI_API_KEY
        sync: false
      # Optional: YouTube Data API for captions (captions.download needs OAuth; list works with key)
      - key: YOUTUBE_API_KEY
        sync: false
      # Optional: when YouTube blocks cloud IPs ("Sign in to confirm you're not a bot") â€” paste
      # Netscape-format cookie file contents here; build writes to youtube_cookies.txt
      - key: YOUTUBE_COOKIES_TXT
        sync: false
      # Path to cookies file (set to youtube_cookies.txt if using YOUTUBE_COOKIES_TXT above)
      - key: YOUTUBE_COOKIES_FILE
        sync: false
    disk:
      name: noteflow-data
      mountPath: /opt/render/project/src/static/uploads
      sizeGB: 1
