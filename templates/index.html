{% extends "base.html" %}

{% block content %}
<!-- Chat Container -->
<div class="chat-container">
    <!-- Chat Header -->
    <div class="chat-header">
        <div class="chat-header-info">
            <div class="ai-avatar">ğŸ¤–</div>
            <div>
                <h3>NoteFlow AI Assistant</h3>
                <p class="status-text">Online â€¢ Ready to help <span style="font-size: 0.85em; font-style: italic; opacity: 0.7;">â€¢ by Mayar</span></p>
            </div>
        </div>
    </div>

    <!-- Chat Messages Area -->
    <div class="chat-messages" id="chatMessages">
        <!-- Welcome Message -->
        <div class="message ai-message">
            <div class="message-avatar">ğŸ¤–</div>
            <div class="message-content">
                <div class="message-bubble">
                    <p>ğŸ‘‹ Hi! I'm your NoteFlow AI assistant.</p>
                    <p>I can help you transform content into structured notes:</p>
                    <ul>
                        <li>ğŸ¤ <strong>Audio recordings</strong> - Record or upload MP3, WAV, M4A</li>
                        <li>ğŸ“š <strong>Books & Documents</strong> - Upload PDF, EPUB, TXT, DOCX</li>
                        <li>ğŸ¬ <strong>Videos</strong> - Upload files or paste YouTube URLs</li>
                    </ul>
                    <p><strong>Just drop a file below or click to browse!</strong> âœ¨</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Input Area -->
    <div class="chat-input-area">
        <form id="chatForm" enctype="multipart/form-data" onsubmit="return false;">
            <!-- Recording Interface (Inline) -->
            <div class="inline-recording" id="inlineRecording" style="display: none;">
                <div class="recording-content">
                    <div class="recording-header">
                        <span class="recording-icon">ğŸ™ï¸</span>
                        <span class="recording-title">Recording...</span>
                        <button type="button" class="close-recording" id="closeInlineRecording">âœ•</button>
                    </div>

                    <div class="recording-body">
                        <div class="recording-timer" id="inlineRecordingTimer">
                            <span class="timer-display" id="inlineTimerDisplay">00:00</span>
                        </div>

                        <div class="recording-controls">
                            <button type="button" class="rec-btn rec-start" id="inlineStartRecordBtn">
                                <span>âº</span>
                                <span>Start</span>
                            </button>
                            <button type="button" class="rec-btn rec-stop" id="inlineStopRecordBtn" style="display: none;">
                                <span>â¹</span>
                                <span>Stop</span>
                            </button>
                        </div>

                        <div class="recording-preview" id="inlineAudioPreview" style="display: none;">
                            <audio controls id="inlineAudioPlayback" class="audio-playback"></audio>
                            <div class="preview-actions">
                                <button type="button" class="rec-btn rec-use" id="inlineUseRecordingBtn">
                                    <span>âœ“</span>
                                    <span>Use Recording</span>
                                </button>
                                <button type="button" class="rec-btn rec-discard" id="inlineDiscardRecordingBtn">
                                    <span>ğŸ—‘ï¸</span>
                                    <span>Discard</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Text Input (Default) -->
            <div class="chat-text-input" id="chatTextInput">
                <!-- Input wrapper with icons inside -->
                <div class="input-wrapper">
                    <!-- Icons inside input (left side) -->
                    <div class="input-icons-inside">
                        <button type="button" class="input-icon-btn" id="recordAudioBtn" title="Record Audio">
                            ğŸ™ï¸
                        </button>
                        <button type="button" class="input-icon-btn" id="uploadFileBtn" title="Upload File">
                            ğŸ“
                        </button>
                        <button type="button" class="input-icon-btn" id="youtubeBtn" title="YouTube URL">
                            ğŸ¬
                        </button>
                    </div>

                    <input type="text" id="userMessageInput" placeholder="Type your message..." class="text-input-field" autocomplete="off">

                    <button type="button" class="send-btn" id="sendMessageBtn" title="Send message">
                        <span>â¤</span>
                    </button>
                </div>
            </div>

            <!-- Hidden File Input (for programmatic file selection) -->
            <input type="file" id="chatFileInput" name="file"
                   accept="audio/*,video/*,.pdf,.epub,.txt,.docx,.doc,.mp3,.wav,.m4a,.ogg,.flac,.webm,.opus,.mp4,.mov,.avi,.mkv"
                   class="file-input" style="display: none;">

            <!-- URL Input for YouTube -->
            <div class="chat-url-input" id="chatUrlInput" style="display: none;">
                <input type="text" id="youtubeUrl" placeholder="ğŸ”— Paste YouTube URL here..." class="url-input-field">
                <button type="button" class="url-submit-btn" id="submitUrl">Send</button>
                <button type="button" class="url-cancel-btn" id="cancelUrl">âœ•</button>
            </div>
        </form>
    </div>
</div>

<!-- Recording Modal (Deprecated - Now using inline recording) -->
<div id="recordingModal" class="modal" style="display: none !important;">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <h2>
                <span>ğŸ™ï¸</span>
                <span>Record Audio</span>
            </h2>
            <button class="modal-close" id="closeRecordingModal">
                <span>&times;</span>
            </button>
        </div>
        <div class="modal-body" style="text-align: center;">
            <div class="recording-status" id="recordingStatus">
                <div class="recording-icon-large">ğŸ”´</div>
                <p class="recording-hint-text">Click Record to start</p>
            </div>

            <div class="recording-timer-large" id="recordingTimerLarge" style="display: none;">
                <span class="recording-pulse"></span>
                <span id="timerDisplayLarge" style="font-size: 2.5rem; font-weight: 600; color: var(--primary-color);">00:00</span>
            </div>

            <div class="recording-controls-modal">
                <button type="button" class="btn" id="startRecordBtn">
                    <span>ğŸ™ï¸</span>
                    <span>Start Recording</span>
                </button>
                <button type="button" class="btn btn-secondary" id="stopRecordBtn" style="display: none;">
                    <span>â¹ï¸</span>
                    <span>Stop Recording</span>
                </button>
            </div>

            <div class="audio-preview-modal" id="audioPreviewModal" style="display: none;">
                <p style="margin: 20px 0 10px; font-weight: 600;">Preview:</p>
                <audio id="audioPlaybackModal" controls style="width: 100%; margin-bottom: 20px;"></audio>
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button type="button" class="btn" id="useRecordingBtn">
                        <span>âœ…</span>
                        <span>Use Recording</span>
                    </button>
                    <button type="button" class="btn btn-secondary" id="discardRecordingBtn">
                        <span>ğŸ—‘ï¸</span>
                        <span>Discard</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Result Modal (Hidden - Results shown in chat instead) -->
<div id="resultModal" class="modal" style="display: none !important;">
    <div class="modal-content">
        <div class="modal-header">
            <h2>
                <span>âœ…</span>
                <span id="resultModalTitle">Your Notes</span>
            </h2>
            <button class="modal-close" id="closeModal">
                <span>&times;</span>
            </button>
        </div>

        <div class="modal-body">
            <div class="transcript" id="transcriptSection">
                <h3>ğŸ“ Transcript</h3>
                <p id="modalTranscript"></p>
            </div>

            <div class="notes">
                <div class="summary-header">
                    <h3>âœ¨ AI-Generated Summary</h3>
                    <div class="translate-controls">
                        <select id="modalTargetLanguage" class="language-select-inline" onchange="translateModalSummary()">
                            <option value="">ğŸŒ Translate</option>
                            <option value="Spanish">ğŸ‡ªğŸ‡¸ Spanish</option>
                            <option value="French">ğŸ‡«ğŸ‡· French</option>
                            <option value="German">ğŸ‡©ğŸ‡ª German</option>
                            <option value="Arabic">ğŸ‡¸ğŸ‡¦ Arabic</option>
                            <option value="Chinese">ğŸ‡¨ğŸ‡³ Chinese</option>
                            <option value="Japanese">ğŸ‡¯ğŸ‡µ Japanese</option>
                            <option value="Korean">ğŸ‡°ğŸ‡· Korean</option>
                            <option value="Portuguese">ğŸ‡µğŸ‡¹ Portuguese</option>
                            <option value="Russian">ğŸ‡·ğŸ‡º Russian</option>
                            <option value="Italian">ğŸ‡®ğŸ‡¹ Italian</option>
                            <option value="Hindi">ğŸ‡®ğŸ‡³ Hindi</option>
                            <option value="Turkish">ğŸ‡¹ğŸ‡· Turkish</option>
                        </select>
                    </div>
                </div>
                <div id="modalSummary"></div>
            </div>

            <!-- Export Options -->
            <div class="export-options">
                <button class="btn btn-export export-btn" onclick="exportModalAsText()">
                    <span>ğŸ“¥</span>
                    <span>Export as TXT</span>
                </button>
                <button class="btn btn-export export-btn" onclick="exportModalAsMarkdown()">
                    <span>ğŸ“„</span>
                    <span>Export as Markdown</span>
                </button>
                <button class="btn btn-secondary export-btn" onclick="copyModalToClipboard()">
                    <span>ğŸ“‹</span>
                    <span>Copy to Clipboard</span>
                </button>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn" onclick="closeResultModal()">
                    <span>â¬†</span>
                    <span>Upload Another File</span>
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/chat.js') }}"></script>
{% endblock %}
